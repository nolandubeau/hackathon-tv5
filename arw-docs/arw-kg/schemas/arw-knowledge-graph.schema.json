{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://arw.dev/schemas/arw-knowledge-graph.schema.json",
  "title": "ARW Knowledge Graph Manifest",
  "description": "JSON Schema for ARW Knowledge Graph discovery manifest",
  "type": "object",
  "required": ["version", "tier", "graph", "schema", "endpoints"],
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "description": "Knowledge graph manifest version",
      "examples": ["1.0"]
    },
    "tier": {
      "type": "string",
      "enum": ["free", "enterprise"],
      "description": "Feature tier level"
    },
    "graph": {
      "type": "object",
      "required": ["name", "database", "scale"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable graph name"
        },
        "description": {
          "type": "string",
          "description": "Graph purpose and scope"
        },
        "database": {
          "type": "string",
          "description": "Graph database engine",
          "examples": ["mgraph-db", "neo4j", "tigergraph"]
        },
        "scale": {
          "type": "object",
          "required": ["nodes", "edges", "last_built"],
          "properties": {
            "nodes": {
              "type": "integer",
              "minimum": 0,
              "description": "Total node count"
            },
            "edges": {
              "type": "integer",
              "minimum": 0,
              "description": "Total edge count"
            },
            "last_built": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp of last graph build"
            },
            "coverage": {
              "type": "string",
              "pattern": "^[0-9]+%$",
              "description": "Percentage of ARW content in graph",
              "examples": ["100%", "85%"]
            }
          }
        }
      }
    },
    "schema": {
      "type": "object",
      "required": ["node_types", "edge_types"],
      "properties": {
        "node_types": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "count", "description"],
            "properties": {
              "type": {
                "type": "string",
                "description": "Node type identifier",
                "examples": ["Page", "Section", "ContentItem"]
              },
              "count": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of nodes of this type"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description"
              },
              "properties": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Available properties on this node type"
              }
            }
          }
        },
        "edge_types": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "count", "description"],
            "properties": {
              "type": {
                "type": "string",
                "description": "Edge type identifier",
                "examples": ["CONTAINS", "HAS_TOPIC", "RELATED_TO"]
              },
              "count": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of edges of this type"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description"
              }
            }
          }
        }
      }
    },
    "enrichments": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["embeddings", "topics", "sentiment", "personas", "similarity"]
          },
          "description": "Active enrichment stages"
        },
        "embeddings": {
          "type": "object",
          "properties": {
            "model": {
              "type": "string",
              "description": "Embedding model identifier"
            },
            "dimensions": {
              "type": "integer",
              "description": "Vector dimensions"
            },
            "cache": {
              "type": "string",
              "description": "Caching strategy"
            }
          }
        },
        "topics": {
          "type": "object",
          "properties": {
            "model": {
              "type": "string",
              "description": "LLM model for topic extraction"
            },
            "unique_topics": {
              "type": "integer",
              "description": "Number of unique topics identified"
            },
            "coverage": {
              "type": "string",
              "pattern": "^[0-9]+%$",
              "description": "Percentage of content with topics"
            }
          }
        },
        "sentiment": {
          "type": "object",
          "properties": {
            "model": {
              "type": "string",
              "description": "LLM model for sentiment analysis"
            },
            "types": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["positive", "neutral", "negative", "mixed"]
              },
              "description": "Supported sentiment types"
            }
          }
        },
        "personas": {
          "type": "object",
          "properties": {
            "targets": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Target persona categories"
            }
          }
        },
        "similarity": {
          "type": "object",
          "properties": {
            "algorithm": {
              "type": "string",
              "description": "Similarity algorithm name"
            },
            "weights": {
              "type": "object",
              "properties": {
                "embedding": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "topic_overlap": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "entity_similarity": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                }
              },
              "description": "Multi-signal weights"
            },
            "threshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Minimum similarity score"
            },
            "top_k": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of similar items to return"
            }
          }
        }
      }
    },
    "endpoints": {
      "type": "object",
      "required": ["query"],
      "properties": {
        "query": {
          "type": "string",
          "format": "uri-reference",
          "description": "Query API endpoint"
        },
        "search": {
          "type": "string",
          "format": "uri-reference",
          "description": "Search API endpoint"
        },
        "nodes": {
          "type": "string",
          "format": "uri-reference",
          "description": "Node retrieval endpoint"
        },
        "edges": {
          "type": "string",
          "format": "uri-reference",
          "description": "Edge retrieval endpoint"
        },
        "visualization": {
          "type": "string",
          "format": "uri-reference",
          "description": "Graph visualization endpoint"
        },
        "export": {
          "type": "string",
          "format": "uri-reference",
          "description": "Data export endpoint"
        }
      }
    },
    "protocols": {
      "type": "object",
      "properties": {
        "graphql": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "format": "uri-reference"
            },
            "schema": {
              "type": "string",
              "format": "uri-reference"
            }
          }
        },
        "sparql": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "format": "uri-reference"
            }
          }
        },
        "mcp": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "endpoint": {
              "type": "string",
              "format": "uri-reference"
            },
            "description": {
              "type": "string"
            }
          }
        }
      }
    },
    "policies": {
      "type": "object",
      "properties": {
        "access": {
          "type": "string",
          "enum": ["public", "authenticated", "enterprise_tier"],
          "description": "Access control level"
        },
        "rate_limits": {
          "type": "object",
          "properties": {
            "free": {
              "type": "string",
              "description": "Rate limit for free tier"
            },
            "enterprise": {
              "type": "string",
              "description": "Rate limit for enterprise tier"
            }
          }
        },
        "data_retention": {
          "type": "string",
          "description": "Data retention policy"
        },
        "privacy": {
          "type": "string",
          "description": "Privacy policy summary"
        }
      }
    },
    "build": {
      "type": "object",
      "properties": {
        "source": {
          "type": "string",
          "description": "Content source identifier"
        },
        "pipeline": {
          "type": "string",
          "description": "Build pipeline description"
        },
        "trigger": {
          "type": "string",
          "description": "Build trigger method"
        },
        "last_build": {
          "type": "object",
          "properties": {
            "timestamp": {
              "type": "string",
              "format": "date-time"
            },
            "duration": {
              "type": "string",
              "description": "Build duration"
            },
            "status": {
              "type": "string",
              "enum": ["success", "partial", "failed"]
            },
            "nodes_processed": {
              "type": "integer"
            },
            "enrichment_cost": {
              "type": "string",
              "description": "Cost in USD"
            }
          }
        },
        "next_build": {
          "type": "string",
          "format": "date-time",
          "description": "Next scheduled build timestamp"
        }
      }
    }
  }
}
